// Game tile map logic
function level() {
	newPlayer.position.x = 650;
	newPlayer.position.y = 400;
	let tileAtlas = new Image();
	tileAtlas.src = '../images/tileset.png';

	tileAtlas.onload = draw;

	tileSize = 16;
	tileOutputSize = 1.88; // set to scale tiles bigger or smaller
	updatedTileSize = tileSize * tileOutputSize;

	let gameMap = [
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 65, 0, 0, 0, 0, 0, 0, 0, 31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 58, 0, 0, 0, 0, 31, 7, 0, 0, 0, 0, 0, 0, 0, 38, 48, 46, 0, 18, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 32, 33, 34, 0, 28, 0, 38, 44, 49, 46,
		0, 0, 0, 0, 23, 1, 2, 3, 0, 32, 19, 34, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 47, 0, 1, 2, 2, 3, 0, 5, 0, 0, 30, 8, 9, 10, 0, 0, 0, 0, 0, 55, 55, 0, 0, 0, 0, 0, 24, 0, 0, 0, 5, 22, 15, 16, 16, 17, 0, 0, 0, 24, 30, 15, 16, 17, 0, 0, 0, 0, 0, 42, 42, 0, 0, 0, 0, 0, 38, 49, 40, 0, 0, 29, 0, 0, 0, 0, 0, 24, 0, 31, 30, 0, 0, 0, 0, 1, 2, 3, 0, 0, 0, 0, 56, 18, 0, 0, 1, 2, 3, 0, 0, 36, 63, 63, 0, 0, 48, 38, 49, 38, 37, 0, 0, 0, 24, 8, 9, 10, 0, 0, 0, 65, 51, 26, 0, 0, 8, 9, 10, 0, 0, 4, 5, 6, 22, 0, 1, 2, 2, 2, 3, 0, 1, 5, 5, 5, 5, 6, 0, 0, 0, 42, 51, 33, 0, 30, 15, 16, 17, 0, 0, 0, 0, 0, 29, 0, 8, 9, 9, 9, 10, 0, 8, 10, 38, 0, 0, 0, 0, 56, 50, 18, 18, 18, 0, 30, 0, 0, 0, 0, 0, 0, 0, 0, 22, 0, 8, 9, 9, 9, 10, 0, 8, 1, 2, 6, 0, 0, 22, 18, 18, 26, 26, 26, 0, 37, 62, 62, 49, 46, 0, 0, 0, 0, 36, 46, 8, 9, 12, 9, 10, 40, 8, 8, 10, 0, 0, 0, 36, 32, 25, 33, 44, 26, 2, 2, 2, 2, 2, 3, 0, 42, 42, 0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 8, 10, 0, 0,
		18, 19, 19, 26, 26, 26, 26, 9, 9, 9, 9, 9, 10, 41, 41, 41, 41, 8, 9, 9, 9, 9, 9, 9, 9, 9, 8, 18, 19, 20, 32, 32, 33, 33, 33, 33, 33,
	];

	let atlasCol = 7;
	let atlasRow = 11;

	let mapRows = 20;
	let mapCols = 30;
	let mapHeight = mapRows * tileSize;
	let mapWidth = mapCols * tileSize;

	let mapIndex = 0;
	let sourceX = 0;
	let sourceY = 0;

	function draw() {
		for (let col = 0; col < mapHeight; col += tileSize) {
			for (let row = 0; row < mapWidth; row += tileSize) {
				let tileVal = gameMap[mapIndex];
				if (tileVal != 0) {
					tileVal -= 1;
					sourceY = Math.floor(tileVal / atlasCol) * tileSize + 0.5;
					sourceX = (tileVal % atlasCol) * tileSize;
					backgroundctx.drawImage(
						tileAtlas,
						sourceX,
						sourceY,
						16,
						16,
						row * tileOutputSize,
						col * tileOutputSize,
						16 * tileOutputSize,
						16 * tileOutputSize
					);
				}

				mapIndex++;
			}
		}
		drawBackground();
	}

	function drawBackground() {
		backgroundImg.appendChild(canvasBackground)
	}


    collsionMapCols = 30;
    collisionMapRows = 16;

    collisionMap = [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0,13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,13, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 3, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 3,11, 0, 6, 7,11, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 9, 3, 3,11, 0, 3, 0, 0, 0, 2, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 3, 0, 2, 1, 1, 4, 0, 0, 0, 0, 0, 6, 1, 8, 0, 0, 0, 0, 0, 9,11, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 0, 9,
        0, 0, 9, 3,11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0,
        0, 0, 4, 0, 2, 0, 0, 3, 3, 3, 0, 0, 9, 3, 3, 3,11, 0, 9, 3, 3, 3, 3, 3, 0, 0, 0, 9, 0, 0,
        0, 0, 6, 1, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 9, 3, 3, 0, 0, 0, 9, 3, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,13, 0, 2, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0,
        9, 3, 3, 3, 3,11, 0, 9,11, 0, 9, 3, 3, 3, 3, 3, 3, 0, 3, 4, 0, 0, 0, 9, 3, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 4, 3, 2, 4, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 0, 0, 0, 0, 0,
    ]

}

if (typeof backgroundctx !== 'undefined') level();
